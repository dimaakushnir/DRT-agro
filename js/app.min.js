// Dinamic adaptive
let da_elements = document.querySelectorAll('[data-da]');
let parents_original = [];
let attr_elements = [];
let attr_element = [];
let match_media = [];

for (let item of da_elements) {
    let parentChildren = item.parentElement.children;
    for (let i = 0; i < parentChildren.length; i++) {
        if (parentChildren[i] == item) {
            parents_original.push({
                'parent': item.parentElement,
                'index': i
            })
        }
    }
}

for (let item of da_elements) {
    attr_elements.push(item.dataset.da);
}

for (let i = 0; i < attr_elements.length; i++) {
    match_media.push(window.matchMedia("(max-width:" + attr_elements[i].split(', ')[2] + "px)"));
    match_media[i].addEventListener('change', dinamic_adapt);
}

function dinamic_adapt() {
    for (let i = 0; i < match_media.length; i++) {
        if (match_media[i].matches) {
            attr_element = attr_elements[i].split(', ');
            document.querySelector(`.${attr_element[0]}`).insertBefore(da_elements[i], document.querySelector(`.${attr_element[0]}`).children[attr_element[1]]);
        } else {
            parents_original[i].parent.insertBefore(da_elements[i], parents_original[i].parent.children[parents_original[i].index]);
        }
    }
}
dinamic_adapt();

// IBG
let ibg = document.querySelectorAll('.ibg');

if (ibg) {
    for (let item of ibg) {
        let ibgImg = item.querySelector('img');
        let ibgImgSrc = ibgImg.getAttribute('src');
        item.style.backgroundImage = `url(${ibgImgSrc})`;
    }
}

// Dropdown
let dropdowns = document.querySelectorAll('.dropdown');

if (dropdowns) {
    dropdowns.forEach(function (dropdown) {
        let dropdown_btn = dropdown.querySelector('.dropdown__btn');
        let dropdown_items = dropdown.querySelectorAll('.dropdown__list-item');
        let dropdown_input_hidden = dropdown.querySelector('.dropdown__input-hidden');
        let dropdown_btn_text;

        if (dropdown_btn) {
            dropdown_btn_text = dropdown_btn.querySelector('.btn-dropdown__text');
        }

        if (dropdown_btn) {
            dropdown_btn.addEventListener('click', function (event) {
                event.preventDefault();

                dropdown.classList.toggle('active');
            })

            if (dropdown_items) {
                dropdown_items.forEach(function (dropdown_item) {
                    dropdown_item.addEventListener('click', function (event) {
                        if (dropdown_btn_text) {
                            dropdown_btn_text.textContent = dropdown_item.textContent;
                        }

                        if (dropdown_input_hidden) {
                            dropdown_input_hidden.value = dropdown_item.dataset.dropdown;
                        }

                        dropdown.classList.remove('active');
                    })
                })
            }
        }
    })
}


// Slider Home Main
if (document.querySelector('.slider-main-home__swiper')) {
    const swiperHomeMain = new Swiper('.slider-main-home__swiper', {
        allowTouchMove: false,
        // If we need pagination
        pagination: {
            el: '.slider-main-home__pagination',
            clickable: true,
        },

        // Navigation arrows
        navigation: {
            nextEl: '.slider-main-home__btn-next',
            prevEl: '.slider-main-home__btn-prev',
        },

        breakpoints: {
            320: {
                allowTouchMove: true,
            },
            992.98: {
                allowTouchMove: false,
            },
        }
    });
}


// Burger
let burger = document.querySelector('.main-header__burger');
let mobile_header = document.querySelector('.mobile-header');
let header = document.querySelector('.header');
let body = document.querySelector('body');

if (burger && header && mobile_header) {
    burger.addEventListener('click', function (event) {
        event.preventDefault();

        burger.classList.toggle('active');
        header.classList.toggle('active');
        mobile_header.classList.toggle('active');
        body.classList.toggle('lock');
    })
}


// Mobile Menu Header
let menu_header_links_submenu = document.querySelectorAll('.menu-header__link_submenu');

if (menu_header_links_submenu) {
    menu_header_links_submenu.forEach(function (menu_header_link_submenu) {
        if (document.documentElement.clientWidth <= 992) {
            menu_header_link_submenu.addEventListener('click', function (event) {
                event.preventDefault();

                let parent_item = menu_header_link_submenu.parentElement.closest('.menu-header__item');
                let dropdown_menu;

                if (parent_item) {
                    dropdown_menu = parent_item.querySelector('.menu-header__dropdown-block');
                }

                if (dropdown_menu) {
                    menu_header_link_submenu.classList.toggle('open');
                    parent_item.classList.toggle('active');
                    dropdown_menu.classList.toggle('active');
                }
            })
        }
    })
}

// Mobile Menu Footer
let menu_footer_links_submenu = document.querySelectorAll('.menu-footer__link_submenu');

if (menu_footer_links_submenu) {
    menu_footer_links_submenu.forEach(function (menu_footer_link_submenu) {
        if (document.documentElement.clientWidth <= 992) {
            menu_footer_link_submenu.addEventListener('click', function (event) {
                event.preventDefault();

                let parent_item = menu_footer_link_submenu.parentElement.closest('.menu-footer__item');
                let dropdown_menu;

                if (parent_item) {
                    dropdown_menu = parent_item.querySelector('.menu-footer__dropdown-block');
                }

                if (dropdown_menu) {
                    menu_footer_link_submenu.classList.toggle('open');
                    parent_item.classList.toggle('active');
                    dropdown_menu.classList.toggle('active');
                }
            })
        }
    })
}

// Home Services
let home_services_columns = document.querySelectorAll('.services-home__column');

if (home_services_columns) {
    home_services_columns.forEach(function (home_services_column) {
        home_services_column.addEventListener('click', function (event) {
            if (!event.target.closest('.item-services-home__btn') && home_services_column.classList.contains('active')) {

                home_services_column.classList.remove('active');

            } else if (!event.target.closest('.item-services-home__btn') && !home_services_column.classList.contains('active')) {
                home_services_columns.forEach(function (column) {
                    column.classList.remove('active');
                })

                home_services_column.classList.add('active');
            }
        })
    })
}

// Popup
function popupClose() {
    let popup_open = document.querySelector('.popup.open');

    if (popup_open) {
        body.classList.remove('lock');
        popup_open.classList.remove('open');
        popup_open.classList.remove('close');
    }
}

document.addEventListener('keydown', function (event) {
    if (event.code === 'Escape') {
        popupClose();
    }
});

document.addEventListener('click', function (event) {
    if (!event.target.closest('.popup__content') && document.querySelector('.popup.close')) {
        popupClose();
    }
})

if (document.querySelector('.popup')) {
    var touchStartY = 0;
    var touchEndY = 0;

    let popups = document.querySelectorAll('.popup');

    if (popups) {
        popups.forEach(function (popup) {
            popup.addEventListener('touchstart', function (event) {
                touchStartY = event.touches[0].clientY;
            });

            popup.addEventListener('touchend', function (event) {
                touchEndY = event.changedTouches[0].clientY;
                handleSwipe();

            });
        })
    }

    function handleSwipe() {
        var swipeDistance = touchStartY - touchEndY;
        var minSwipeDistance = 100; // Мінімальна відстань свайпу, щоб закрити модальне вікно

        if (swipeDistance > minSwipeDistance) {
            popupClose();
        }
    }

}

// Popup Consultation
let popup_consultation = document.querySelector('.popup-consultation');
let popup_consultation_btns = document.querySelectorAll('.btn-consultation')

if (popup_consultation_btns) {
    popup_consultation_btns.forEach(function (popup_consultation_btn) {
        popup_consultation_btn.addEventListener('click', function (event) {
            event.preventDefault();

            if (popup_consultation) {
                body.classList.add('lock');
                popup_consultation.classList.add('open');

                setTimeout(function (event) {
                    popup_consultation.classList.add('close');
                }, 300);
            }
        })
    })
}


// Popups Countries
let country_points = document.querySelectorAll('.countries__point');
let popups_countries = document.querySelectorAll('.popup-countries');

if (country_points) {
    country_points.forEach(function (country_point) {
        country_point.addEventListener('click', function (event) {
            event.preventDefault();

            if (popups_countries) {
                popups_countries.forEach(function (popup_country) {
                    if (popup_country.dataset.country == country_point.dataset.country) {
                        body.classList.add('lock');
                        popup_country.classList.add('open');

                        setTimeout(function (event) {
                            popup_country.classList.add('close');
                        }, 300);
                    }
                })
            }
        })
    })
}

// Popups Contact
let popup_contact_btns = document.querySelectorAll('.open-popup-contact');
let popup_contact = document.querySelector('.popup-contact');

if (popup_contact_btns) {
    popup_contact_btns.forEach(function (popup_contact_btn) {
        popup_contact_btn.addEventListener('click', function (event) {
            event.preventDefault();

            if (popup_contact) {
                body.classList.add('lock');
                popup_contact.classList.add('open');

                setTimeout(function (event) {
                    popup_contact.classList.add('close');
                }, 300);
            }
        })
    })
}

// Popups Projects
let popup_projects_btns = document.querySelectorAll('.open-popup-projects');
let popup_projects = document.querySelector('.popup-projects');

if (popup_projects_btns) {
    popup_projects_btns.forEach(function (popup_projects_btn) {
        popup_projects_btn.addEventListener('click', function (event) {
            event.preventDefault();

            if (popup_projects) {
                body.classList.add('lock');
                popup_projects.classList.add('open');

                setTimeout(function (event) {
                    popup_projects.classList.add('close');
                }, 300);
            }
        })
    })
}

// Маска номера телефона
if (document.querySelector('.tel')) {
    $(document).ready(function () {
        $('.tel').inputmask("+380 99 - 999 - 99 - 99");
    });
}


// Seo Text
if (document.querySelector('.seo-footer')) {
    $('.top-seo-footer').click(function () {
        $(this).toggleClass('active');
        $(this).next().slideToggle(300);
    });
}


// Btn Up
let btn_up = document.querySelector('.footer__btn-up');

if (btn_up) {
    btn_up.addEventListener("click", () => {
        window.scrollTo({
            top: 0,
            behavior: "smooth"
        });
    });
}


// Faqs
if (document.querySelector('.top-item-faqs')) {
    $('.top-item-faqs').click(function () {
        $(this).toggleClass('active');
        $(this).next().slideToggle(300);
    });
}

let faq_btns = document.querySelectorAll('.top-item-faqs__btn');

if (faq_btns) {
    faq_btns.forEach(function (faq_btn) {
        faq_btn.addEventListener('click', function (event) {
            event.preventDefault();
        })
    })
}

// Filter
if (document.querySelector('.filter-top-catalog__swiper')) {
    const swiperFilterMenu = new Swiper('.filter-top-catalog__swiper', {
        // Опціональні параметри
        slidesPerView: "auto",
    });
}

let catalog = document.querySelector('.catalog');

if (catalog) {
    let filter_btns = catalog.querySelectorAll('.filter-top-catalog__btn');
    let filter_columns = catalog.querySelectorAll('.catalog__column');

    if (filter_btns && filter_columns) {
        filter_btns.forEach(function (filter_btn) {
            filter_btn.addEventListener('click', function (event) {
                event.preventDefault();

                if (filter_btn.dataset.filter == 'all') {
                    filter_columns.forEach(function (filter_column) {
                        filter_column.style.display = 'block';
                    })
                } else {
                    filter_columns.forEach(function (filter_column) {
                        if (filter_column.dataset.filter == filter_btn.dataset.filter) {
                            filter_column.style.display = 'block';
                        } else {
                            filter_column.style.display = 'none';
                        }
                    })
                }

                filter_btns.forEach(function (btn) {
                    btn.classList.remove('active');
                })

                filter_btn.classList.add('active');
            })
        })
    }
}

// Filters
// 1
if (document.querySelector('.slider-item-filters-catalog__swiper_1')) {
    const swiperFiltersMenu1 = new Swiper('.slider-item-filters-catalog__swiper_1', {
        // Опціональні параметри
        slidesPerView: "auto",
        // spaceBetween: 20,
    });
}

// 2
if (document.querySelector('.slider-item-filters-catalog__swiper_2')) {
    const swiperFiltersMenu2 = new Swiper('.slider-item-filters-catalog__swiper_2', {
        // Опціональні параметри
        slidesPerView: "auto",
        // spaceBetween: 20,
    });
}

// 3
if (document.querySelector('.slider-item-filters-catalog__swiper_3')) {
    const swiperFiltersMenu3 = new Swiper('.slider-item-filters-catalog__swiper_3', {
        // Опціональні параметри
        slidesPerView: "auto",
        // spaceBetween: 20,
    });
}

// Filter Catalog
let catalog_filters = document.querySelector('.catalog-filters');

if (catalog_filters) {
    let catalogs_filter = catalog_filters.querySelectorAll('.item-filters-catalog');
    let filter_columns = catalog_filters.querySelectorAll('.catalog__column');

    if (catalogs_filter) {
        catalogs_filter.forEach(function (catalog_filter) {
            let filter_btns = catalog_filter.querySelectorAll('.item-slide-filters-catalog__btn');

            if (filter_btns) {
                filter_btns.forEach(function (filter_btn) {
                    filter_btn.addEventListener('click', function (event) {
                        event.preventDefault();

                        filter_btns.forEach(function (btn) {
                            btn.classList.remove('active');
                        })

                        filter_btn.classList.add('active');
                    })
                })
            }
        })
    }
}


// Other Product Slider
if (document.querySelector('.slider-other-products__swiper')) {
    const swiperOtherProduct = new Swiper('.slider-other-products__swiper', {
        // Опціональні параметри
        slidesPerView: "auto",
        spaceBetween: 20,
    });
}

// About Info
if (document.querySelector('.slider-top-info-about-product__swiper')) {
    const swiperAboutInfo = new Swiper('.slider-top-info-about-product__swiper', {
        // Опціональні параметри
        slidesPerView: "auto",
        // spaceBetween: 20,
    });
}

// About Info Filter
let info_about_product = document.querySelector('.info-about-product');

if (info_about_product) {
    let info_about_product_btns = info_about_product.querySelectorAll('.item-slide-top-info-about-product__btn');
    // let filter_columns = catalog_filters.querySelectorAll('.catalog__column');

    if (info_about_product_btns) {
        info_about_product_btns.forEach(function (info_about_product_btn) {
            info_about_product_btn.addEventListener('click', function (event) {
                event.preventDefault();

                info_about_product_btns.forEach(function (btn) {
                    btn.classList.remove('active');
                })

                info_about_product_btn.classList.add('active');
            })
        })
    }
}


// Filter Element Deficiencies
if (document.querySelector('.slider-top-element-deficiencies__swiper')) {
    const swiperFilterElementDeficiencies = new Swiper('.slider-top-element-deficiencies__swiper', {
        // Опціональні параметри
        slidesPerView: "auto",
        // spaceBetween: 20,
    });
}

let element_deficiencies = document.querySelector('.element-deficiencies');

if (element_deficiencies) {
    let element_deficiencies_filter_btns = element_deficiencies.querySelectorAll('.item-slide-top-element-deficiencies__btn');
    // let filter_columns = catalog_filters.querySelectorAll('.catalog__column');

    if (element_deficiencies_filter_btns) {
        element_deficiencies_filter_btns.forEach(function (element_deficiencies_filter_btn) {
            element_deficiencies_filter_btn.addEventListener('click', function (event) {
                event.preventDefault();

                element_deficiencies_filter_btns.forEach(function (btn) {
                    btn.classList.remove('active');
                })

                element_deficiencies_filter_btn.classList.add('active');
            })
        })
    }
}


// Filter Fertilizers Product Info
if (document.querySelector('.slider-top-info-fertilizers-product__swiper')) {
    const swiperFilterFertilizersProductInfo = new Swiper('.slider-top-info-fertilizers-product__swiper', {
        // Опціональні параметри
        slidesPerView: 3,
        spaceBetween: 20,

        breakpoints: {
            320: {
                slidesPerView: 'auto',
                spaceBetween: 0,
            },
            1212: {
                slidesPerView: 3,
                spaceBetween: 20,
            },
        }
    });
}

let info_fertilizers_product = document.querySelector('.info-fertilizers-product');

if (info_fertilizers_product) {
    let info_fertilizers_product__btns = info_fertilizers_product.querySelectorAll('.item-slide-top-info-fertilizers-product__btn');
    let info_fertilizers_product_items = info_fertilizers_product.querySelectorAll('.info-fertilizers-product__item');

    if (info_fertilizers_product__btns) {
        info_fertilizers_product__btns.forEach(function (info_fertilizers_product__btn) {
            info_fertilizers_product__btn.addEventListener('click', function (event) {
                event.preventDefault();

                info_fertilizers_product_items.forEach(function (info_fertilizers_product_item) {
                    if (info_fertilizers_product_item.dataset.filter == info_fertilizers_product__btn.dataset.filter) {
                        info_fertilizers_product_item.style.display = 'block';
                    } else {
                        info_fertilizers_product_item.style.display = 'none';
                    }
                })

                info_fertilizers_product__btns.forEach(function (btn) {
                    btn.classList.remove('active');
                })

                info_fertilizers_product__btn.classList.add('active');
            })
        })
    }
}


// Events Slider
if (document.querySelector('.slider-events__swiper')) {
    const swiperEvent = new Swiper('.slider-events__swiper', {
        // Опціональні параметри
        slidesPerView: 2,
        spaceBetween: 20,

        // Navigation arrows
        navigation: {
            nextEl: '.slider-events__btn_next',
            prevEl: '.slider-events__btn_prev',
        },

        breakpoints: {
            320: {
                slidesPerView: 1,
            },
            600: {
                slidesPerView: 2,
            },
        }
    });
}


// Reviews
if (document.querySelector('.reviews__swiper-1')) {
    const swiperReviews1 = new Swiper('.reviews__swiper-1', {
        // Optional parameters
        loop: true,
        slidesPerView: 'auto',
        spaceBetween: 20,
        allowTouchMove: false,
        speed: 5000,
        autoplay: {
            delay: 0,
            disableOnInteraction: false,
        },
    });
}

if (document.querySelector('.reviews__swiper-2')) {
    const swiperReviews1 = new Swiper('.reviews__swiper-2', {
        // Optional parameters
        loop: true,
        slidesPerView: 'auto',
        spaceBetween: 20,
        allowTouchMove: false,
        speed: 5000,
        autoplay: {
            delay: 0,
            disableOnInteraction: false,
            reverseDirection: true,
        },
    });
}

// All News Filter
if (document.querySelector('.filter-top-all-news__swiper')) {
    const swiperAllNewsFilter = new Swiper('.filter-top-all-news__swiper', {
        // Опціональні параметри
        slidesPerView: "auto",
    });
}

let all_news = document.querySelector('.all-news');

if (all_news) {
    let filter_btns = all_news.querySelectorAll('.filter-top-all-news__btn');
    let filter_columns = all_news.querySelectorAll('.all-news__column');

    if (filter_btns && filter_columns) {
        filter_btns.forEach(function (filter_btn) {
            filter_btn.addEventListener('click', function (event) {
                event.preventDefault();

                if (filter_btn.dataset.filter == 'all') {
                    filter_columns.forEach(function (filter_column) {
                        filter_column.style.display = 'block';
                    })
                } else {
                    filter_columns.forEach(function (filter_column) {
                        if (filter_column.dataset.filter == filter_btn.dataset.filter) {
                            filter_column.style.display = 'block';
                        } else {
                            filter_column.style.display = 'none';
                        }
                    })
                }

                filter_btns.forEach(function (btn) {
                    btn.classList.remove('active');
                })

                filter_btn.classList.add('active');
            })
        })
    }
}

// Our Projects Filter
if (document.querySelector('.filter-top-main-our-projects__swiper')) {
    const swiperAllNewsFilter = new Swiper('.filter-top-main-our-projects__swiper', {
        // Опціональні параметри
        slidesPerView: "auto",
    });
}

let our_projects = document.querySelector('.main-our-projects');

if (our_projects) {
    let filter_btns = our_projects.querySelectorAll('.filter-top-main-our-projects__btn');
    let filter_columns = our_projects.querySelectorAll('.main-our-projects__column');

    if (filter_btns && filter_columns) {
        filter_btns.forEach(function (filter_btn) {
            filter_btn.addEventListener('click', function (event) {
                event.preventDefault();

                if (filter_btn.dataset.filter == 'all') {
                    filter_columns.forEach(function (filter_column) {
                        filter_column.style.display = 'block';
                    })
                } else {
                    filter_columns.forEach(function (filter_column) {
                        if (filter_column.dataset.filter == filter_btn.dataset.filter) {
                            filter_column.style.display = 'block';
                        } else {
                            filter_column.style.display = 'none';
                        }
                    })
                }

                filter_btns.forEach(function (btn) {
                    btn.classList.remove('active');
                })

                filter_btn.classList.add('active');
            })
        })
    }
}

// Projects Sliders
if (document.querySelector('.main-slider-popup__swiper') && document.querySelector('.second-slider-popup__swiper')) {
    var swiperSecondSliderProjects = new Swiper(".second-slider-popup__swiper", {
        slidesPerView: "auto",
        freeMode: true,
        watchSlidesProgress: true,
    });

    var swiperMainSliderProjects = new Swiper(".main-slider-popup__swiper", {
        navigation: {
            nextEl: ".main-slider-popup__btn-next",
            prevEl: ".main-slider-popup__btn-prev",
        },
        pagination: {
            el: ".main-slider-popup__pagination",
            clickable: true
        },
        thumbs: {
            swiper: swiperSecondSliderProjects,
        },
    });
}
